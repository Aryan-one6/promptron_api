generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
}

model User {
  id           String       @id @default(cuid())
  name         String
  email        String       @unique
  passwordHash String
  role         UserRole     @default(USER)
  createdAt    DateTime     @default(now())
  templates    Template[]
  saved        SavedTemplate[]
  generated    GeneratedPrompt[]
}

model Platform {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  createdAt DateTime @default(now())
  models    Model[]
  prompts   GeneratedPrompt[]
}

model Model {
  id         String   @id @default(cuid())
  platformId String
  name       String
  slug       String
  isActive   Boolean  @default(true)
  platform   Platform @relation(fields: [platformId], references: [id])
  templates  TemplateModel[]
  prompts    GeneratedPrompt[]

  @@unique([platformId, slug])
}

model Category {
  id    String @id @default(cuid())
  name  String
  slug  String @unique
  templates Template[]
}

model Tag {
  id    String @id @default(cuid())
  name  String
  slug  String @unique
  templates TemplateTag[]
}

model Template {
  id           String         @id @default(cuid())
  title        String
  description  String
  promptSchema Json
  authorId     String
  categoryId   String
  isPublic     Boolean        @default(true)
  isFeatured   Boolean        @default(false)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  author       User           @relation(fields: [authorId], references: [id])
  category     Category       @relation(fields: [categoryId], references: [id])
  models       TemplateModel[]
  tags         TemplateTag[]
  savedBy      SavedTemplate[]
}

model TemplateModel {
  templateId String
  modelId    String
  template   Template @relation(fields: [templateId], references: [id])
  model      Model    @relation(fields: [modelId], references: [id])

  @@id([templateId, modelId])
}

model TemplateTag {
  templateId String
  tagId      String
  template   Template @relation(fields: [templateId], references: [id])
  tag        Tag      @relation(fields: [tagId], references: [id])

  @@id([templateId, tagId])
}

model SavedTemplate {
  userId     String
  templateId String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
  template   Template @relation(fields: [templateId], references: [id])

  @@id([userId, templateId])
}

model GeneratedPrompt {
  id         String   @id @default(cuid())
  userId     String
  platformId String
  modelId    String
  inputs     Json
  finalPrompt String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
  platform   Platform @relation(fields: [platformId], references: [id])
  model      Model    @relation(fields: [modelId], references: [id])
}
